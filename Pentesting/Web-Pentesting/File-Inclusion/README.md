# File Inclusion:

- There are different types:
	1. LFI (Local File Inclusion)
	2. RFI (Remote File Inclusion)
	3. Directory Traversal

<p align="right">14-03-2025</p>
## Lab 2 (LFI - 2)

- Performing "[[Black Box Testing]]"

- After analyzing the web app, we discover the developer specifies the file type to pass at the include function:
```php
Warning: include(languages/../../../../../etc/passwd.php): failed to open stream: No such file or directory in /var/www/html/THM-4/index.php on line 12
```

- To bypass this scenario, we can use the NULL BYTE, which is `%00`
 
	Null bytes is an injection technique where URL-encoded representation such as `%00` or `0x00` in hex with user-supplied data to terminate strings. You could think of it as trying to trick the web app into disregarding whatever comes after the Null Byte. 
	
- Dissecting a URL (Uniform Resource Locator):
```www
lab3.php?file=languages/../../../../../etc/passwd%00.php
``` 

`lab3.php` - The /root file of our server
`?` - The query being performed
`file` - The item we are searching for
`=` - The location of that item

## Lab 4:

- In this scenario the developer is using input validation by filtering some keyworks:
	If we test this parameter: 
	`http://webapp.thm/index.php?lang=../../../../etc/passwd` 

- We receive the error:
```php
Warning: include(languages/etc/passwd): failed to open stream: No such file or directory in /var/www/html/THM-5/index.php on line 15
```

- In the warning message we know the web application replaces the `../` with an empty string!

- We can bypass it by sending a request like this:

`....//....//....//....//....//etc/passwd` 

This works because the PHP filter only matches and replaces the first subset string `../` it finds and doesn't do another pass, leaving what is pictured below.


## Lab 6
- A developer forces the `include()` function to read from a defined directory only:
	For example, if the web application asks to supply input that has to include a directory such as: [http://webapp.thm/index.php?lang=languages/EN.php](http://webapp.thm/index.php?lang=languages/EN.php) then, to exploit this, we need to include the directory in the payload like so: 
	`?lang=languages/../../../../../etc/passwd`

	Try out Lab #6 and check what is the directory that has to be in the input field?
		Answer: `THM-profile`

Try out Lab #6 and read **/etc/os-release**. What is the **VERSION_ID** value?
	Answer: ``
```
File Content Preview of ?lang=THM-profile/../../../../../etc/os-release
NAME="Ubuntu" VERSION="12.04.5 LTS, Precise Pangolin" ID=ubuntu ID_LIKE=debian PRETTY_NAME="Ubuntu precise (12.04.5 LTS)" VERSION_ID="12.04" 
```

## Remote File Inclusion (RFI)
- Consists of injecting remote files into a vulnerable web application

## Remediation:

- Keep system and services, including web application frameworks, updated with the latest version.
- Turn off PHP errors to avoid leaking the path of the application and other potentially revealing information.
- A Web Application Firewall (WAF) is a good option to help mitigate web application attacks.
- Disable some PHP features that cause file inclusion vulnerabilities if your web app doesn't need them, such as allow_url_fopen on and allow_url_include.
- Carefully analyze the web application and allow only protocols and PHP wrappers that are in need.
- Never trust user input, and make sure to implement proper input validation against file inclusion.
- Implement whitelisting for file names and locations as well as blacklisting.
